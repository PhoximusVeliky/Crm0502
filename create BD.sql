drop database CRM;
create database CRM;
use CRM;

-- Создание таблицы "Товары"
CREATE TABLE Товары (
    id_товара INT AUTO_INCREMENT PRIMARY KEY,
    название VARCHAR(255) NOT NULL,
    описание TEXT,
    цена DECIMAL(10, 2) NOT NULL,
    количество INT NOT NULL,
    жанр VARCHAR(100) NOT NULL
);

-- Создание таблицы "Бонусные карты"
CREATE TABLE Бонусные_карты (
    id_карты INT AUTO_INCREMENT PRIMARY KEY,
    код_карты VARCHAR(50) UNIQUE NOT NULL,
    дата_выдачи DATE NOT NULL,
    активна BOOLEAN DEFAULT TRUE
);

-- Создание таблицы "Клиенты"
CREATE TABLE Клиенты (
    id_клиента INT AUTO_INCREMENT PRIMARY KEY,
    имя VARCHAR(255) NOT NULL,
    телефон VARCHAR(20),
    email VARCHAR(255),
    id_карты INT UNIQUE,
    FOREIGN KEY (id_карты) REFERENCES Бонусные_карты(id_карты)
);

-- Создание таблицы "Продажи"
CREATE TABLE Продажи (
    id_продажи INT AUTO_INCREMENT PRIMARY KEY,
    дата_продажи DATETIME NOT NULL,
    id_клиента INT,
    способ_оплаты ENUM('наличные', 'карта') NOT NULL,
    общая_сумма DECIMAL(10, 2) NOT NULL,
    FOREIGN KEY (id_клиента) REFERENCES Клиенты(id_клиента)
);

-- Создание таблицы "Детали продаж"
CREATE TABLE Детали_продаж (
    id_детали INT AUTO_INCREMENT PRIMARY KEY,
    id_продажи INT NOT NULL,
    id_товара INT NOT NULL,
    количество INT NOT NULL,
    цена DECIMAL(10, 2) NOT NULL,
    FOREIGN KEY (id_продажи) REFERENCES Продажи(id_продажи),
    FOREIGN KEY (id_товара) REFERENCES Товары(id_товара)
);

-- Создание таблицы "Изображения"
CREATE TABLE Изображения (
    id_изображения INT AUTO_INCREMENT PRIMARY KEY,
    id_товара INT NOT NULL,
    путь_к_изображению VARCHAR(255) NOT NULL,
    описание TEXT,
    FOREIGN KEY (id_товара) REFERENCES Товары(id_товара) ON DELETE CASCADE
);

-- Заполнение таблицы "Товары"
INSERT INTO Товары (название, описание, цена, количество, жанр) VALUES
('Монополия', 'Классическая настольная игра', 1500.00, 10, 'Экономическая стратегия'),
('Каркассон', 'Игра для создания средневекового мира', 2000.00, 15, 'Стратегия'),
('Манчкин', 'Юмористическая карточная игра', 1200.00, 20, 'Карточная игра'),
('Уно', 'Простая и веселая карточная игра', 500.00, 30, 'Карточная игра'),
('Колонизаторы', 'Игра о развитии и торговле', 2500.00, 8, 'Экономическая стратегия');

-- Заполнение таблицы "Бонусные карты"
INSERT INTO Бонусные_карты (код_карты, дата_выдачи, активна) VALUES
('A123456789', '2023-06-15', TRUE),
('B987654321', '2023-07-20', TRUE),
('C567891234', '2023-08-10', FALSE);

-- Заполнение таблицы "Клиенты"
INSERT INTO Клиенты (имя, телефон, email, id_карты) VALUES
('Иван Иванов', '89261234567', 'ivan@example.com', 1),
('Мария Петрова', '89269874567', 'maria@example.com', 2),
('Сергей Сидоров', '89265556677', 'sergey@example.com', 3),
('Елена Кузнецова', '89263334455', 'elena@example.com', NULL);

-- Заполнение таблицы "Продажи"
INSERT INTO Продажи (дата_продажи, id_клиента, способ_оплаты, общая_сумма) VALUES
('2024-12-01 14:30:00', 1, 'карта', 3000.00),
('2024-12-02 15:00:00', 2, 'наличные', 4500.00),
('2024-12-03 16:45:00', 3, 'карта', 1200.00),
('2024-12-04 17:00:00', 4, 'наличные', 500.00);

-- Заполнение таблицы "Детали продаж"
INSERT INTO Детали_продаж (id_продажи, id_товара, количество, цена) VALUES
(1, 1, 2, 1500.00),  -- Монополия
(1, 3, 1, 1200.00),  -- Манчкин
(2, 2, 2, 2000.00),  -- Каркассон
(3, 3, 1, 1200.00),  -- Манчкин
(4, 4, 1, 500.00);  -- Уно

-- Заполнение таблицы "Изображения"
INSERT INTO Изображения (id_товара, путь_к_изображению, описание) VALUES
(1, '/images/monopoly.jpg', 'Изображение для Монополии'),
(2, '/images/carcassonne.jpg', 'Изображение для Каркассона'),
(3, '/images/munchkin.jpg', 'Изображение для Манчкина'),
(4, '/images/uno.jpg', 'Изображение для Уно'),
(5, '/images/catan.jpg', 'Изображение для Колонизаторов');
